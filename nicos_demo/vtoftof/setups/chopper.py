description = 'chopper setup'

group = 'lowlevel'

devices = dict(
    d1 = device('nicos_mlz.toftof.devices.chopper.Disc',
        description = 'Chopper disc 1',
        fmtstr = '%.0f',
        speed = 100,
        jitter = 2,
        lowlevel = True,
    ),
    d2 = device('nicos_mlz.toftof.devices.chopper.Disc',
        description = 'Chopper disc 2',
        fmtstr = '%.0f',
        speed = 100,
        jitter = 2,
        lowlevel = True,
    ),
    d3 = device('nicos_mlz.toftof.devices.chopper.Disc',
        description = 'Chopper disc 3',
        fmtstr = '%.0f',
        speed = 100,
        jitter = 2,
        lowlevel = True,
    ),
    d4 = device('nicos_mlz.toftof.devices.chopper.Disc',
        description = 'Chopper disc 4',
        fmtstr = '%.0f',
        speed = 100,
        jitter = 2,
        lowlevel = True,
    ),
    d5 = device('nicos_mlz.toftof.devices.chopper.Disc',
        description = 'Chopper disc 5',
        fmtstr = '%.0f',
        speed = 100,
        jitter = 2,
        lowlevel = True,
    ),
    d6 = device('nicos_mlz.toftof.devices.chopper.Disc',
        description = 'Chopper disc 6',
        fmtstr = '%.0f',
        speed = 100,
        jitter = 2,
        lowlevel = True,
    ),
    d7 = device('nicos_mlz.toftof.devices.chopper.Disc',
        description = 'Chopper disc 7',
        fmtstr = '%.0f',
        speed = 100,
        jitter = 2,
        lowlevel = True,
    ),
    ch = device('nicos_mlz.toftof.devices.chopper.VirtualController',
        description = 'TOFTOF chopper control device',
        speed_accuracy = 40,
        phase_accuracy = 10,
        ch5_90deg_offset = 0,
        timeout = 600,
        pollinterval = 10,
        maxage = 12,
        unit = 'rpm',
        discs = ['d1', 'd2', 'd3', 'd4', 'd5', 'd6', 'd7'],
        fmtstr = "%.1f",
        # abslimits = (0., 27000),
        lowlevel = False,
    ),
    chSpeed = device('nicos_mlz.toftof.devices.chopper.Speed',
        description = 'Setpoint of the chopper speed',
        chopper = 'ch',
        chdelay = 'chdelay',
        abslimits = (0, 22000.),
        pollinterval = 10,
        maxage = 12,
        fmtstr = '%.0f',
        unit = 'rpm',
    ),
    chDS = device('nicos_mlz.toftof.devices.chopper.SpeedReadout',
        description = 'Speed of the disks 1 - 7',
        chopper = 'ch',
        fmtstr = '[%.0f, %.0f, %.0f, %.0f, %.0f, %.0f, %.0f]',
        pollinterval = 10,
        maxage = 12,
        unit = 'rpm',
    ),
    chWL = device('nicos_mlz.toftof.devices.chopper.Wavelength',
        description = 'Neutron wavelength',
        chopper = 'ch',
        chdelay = 'chdelay',
        abslimits = (0.2, 16.0),
        pollinterval = 10,
        maxage = 12,
        unit = 'AA',
    ),
    chRatio = device('nicos_mlz.toftof.devices.chopper.Ratio',
        description = 'Frame overlap ratio',
        chopper = 'ch',
        chdelay = 'chdelay',
        pollinterval = 10,
        maxage = 12,
    ),
    chCRC = device('nicos_mlz.toftof.devices.chopper.CRC',
        description = 'Chopper rotation sense (CRC=1, parallel=0)',
        requires = {'level': 'admin'},
        chopper = 'ch',
        chdelay = 'chdelay',
        pollinterval = 10,
        maxage = 12,
    ),
    chST = device('nicos_mlz.toftof.devices.chopper.SlitType',
        description = 'Chopper window; large window=0',
        requires = {'level': 'admin'},
        chopper = 'ch',
        chdelay = 'chdelay',
        pollinterval = 10,
        maxage = 12,
    ),
    chdelay = device('nicos.devices.generic.ManualMove',
        description = 'Trigger time-offset',
        requires = {'level': 'guest'},
        abslimits = (0, 1000000),
        unit = 'usec',
        fmtstr = '%d',
    ),
)
