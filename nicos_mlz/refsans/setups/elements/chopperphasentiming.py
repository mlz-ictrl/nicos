description = 'Chopper phase timing, readout for light barrier and coder index'

group = 'lowlevel'

all_lowlevel = {'metadata', 'devlist', 'namespace'}  # & set()

instrument_values = configdata('instrument.values')

URL = (instrument_values['url_base'] % 'cpt') + 'json-visual'
code_base = instrument_values['code_base']  + 'gkssjson.CPTReadout'

phasesign_val = 'unsigned'

includes = ['chopper']

devices = dict(
    cpt01 = device(code_base + 'proof',
        description = 'Disc 1 index ' + description + ' Phase of Disk1! adjusted to 1.0',
        url = URL,
        chopper = 'chopper_speed',
        speed = 'cpt1',
        valuekey = 'chopper_act',
        timeout = 3.0,
        precision = .25,
        channel = 6,
        offset = -192.60, #2021-07-01 11:34:48 Al-Kante 47.514,  # 2020-07-06 10:18:29 56.404,
        unit = 'deg',
        visibility = all_lowlevel,
        phasesign = phasesign_val,
    ),
    cpt00 = device(code_base,
        description = 'Window signal itself, 2. flank; check duty cycle' + description,
        url = URL,
        valuekey = 'chopper_act',
        timeout = 3.0,
        channel = 4,
        offset = 0.0, #as absolut
        unit = 'deg',
        phasesign = phasesign_val,
    ),
    cpt1 = device(code_base,
        description = 'Disc 1 speed ' + description,
        url = URL,
        valuekey = 'chopper_act',
        timeout = 3.0,
        channel = -1,
        offset = 0,
        unit = 'rpm',
        phasesign = phasesign_val,
    ),
    cpt2 = device(code_base,
        description = 'Disc 2 index ' + description,
        url = URL,
        valuekey = 'chopper_act',
        timeout = 3.0,
        channel = 7,
        offset = 28.556,  # 2020-07-06 10:19:22 28.441,
        unit = 'deg',
        phasesign = phasesign_val,
     ),
    cpt3 = device(code_base,
        description = 'Disc 3 index ' + description,
        url = URL,
        valuekey = 'chopper_act',
        timeout = 3.0,
        channel = 8,
        offset = 70.412,  # 2020-07-06 10:20:09 70.295,
        unit = 'deg',
        phasesign = phasesign_val,
    ),
    cpt4 = device(code_base,
        description = 'Disc 4 index ' + description,
        url = URL,
        valuekey = 'chopper_act',
        timeout = 3.0,
        channel = 9,
        offset = 75.781,  # 2020-07-06 10:22:53 75.666,
        unit = 'deg',
        phasesign = phasesign_val,
    ),
    cpt5 = device(code_base,
        description = 'Disc 5 index ' + description,
        url = URL,
        valuekey = 'chopper_act',
        timeout = 3.0,
        channel = 10,
        offset = 266.735,  # 2020-07-06 10:23:53 266.608,
        unit = 'deg',
        phasesign = phasesign_val,
    ),
    cpt6 = device(code_base,
        description = 'Disc 6 index ' + description,
        url = URL,
        valuekey = 'chopper_act',
        timeout = 3.0,
        channel = 11,
        offset = 176.237,  #2021-04-23 07:06:24 Encoder homeRun 176.237 2020-07-06 10:24:35 176.135,
        unit = 'deg',
        phasesign = phasesign_val,
    ),
    cptoptic1 = device(code_base,
        description = 'Disc 1 optic ' + description,
        url = URL,
        valuekey = 'chopper_act',
        timeout = 3.0,
        channel = 0,
        offset = -6.490,
        unit = 'deg',
        phasesign = phasesign_val,
        visibility = all_lowlevel,
    ),
    cptoptic2 = device(code_base,
        description = 'Disc 2 optic ' + description,
        url = URL,
        valuekey = 'chopper_act',
        timeout = 3.0,
        channel = 1,
        offset = -132.535,  # 2020-07-06 10:26:03 -132.5,
        unit = 'deg',
        phasesign = phasesign_val,
        visibility = all_lowlevel,
    ),
    cptoptic3 = device(code_base,
        description = 'Disc 3 optic ' + description,
        url = URL,
        valuekey = 'chopper_act',
        timeout = 3.0,
        channel = 2,
        offset = -62.479,  # 2020-07-06 10:26:53 -62.5,
        unit = 'deg',
        phasesign = phasesign_val,
        visibility = all_lowlevel,
    ),
    cptoptic4 = device(code_base,
        description = 'Disc 4 optic ' + description,
        url = URL,
        valuekey = 'chopper_act',
        timeout = 3.0,
        channel = 3,
        offset = -183.981,  # 2020-07-06 10:27:32 -184.0,
        unit = 'deg',
        phasesign = phasesign_val,
        visibility = all_lowlevel,
    ),
)
