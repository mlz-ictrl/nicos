description = 'TOF counter devices'

group = 'lowlevel'

includes = ['vchopper', 'slit', 'rc']

excludes = ['detector']

devices = dict(
    # monitor = device('nicos.devices.generic.VirtualCounter',
    #     description = 'TOFTOF monitor',
    #     fmtstr = '%d',
    #     type = 'monitor',
    #     visibility = (),
    #     pollinterval = None,
    # ),
    monitor = device('nicos_virt_mlz.toftof.devices.detector.McStasCounter',
        description = 'TOFTOF monitor',
        mcstas = 'mcstas',
        mcstasfile = 'TOFTOF_monitor.dat',
        type = 'monitor',
        fmtstr = '%d',
        visibility = (),
        pollinterval = None,
    ),
    # timer = device('nicos.devices.generic.VirtualTimer',
    #     description = 'TOFTOF timer',
    #     fmtstr = '%.2f',
    #     unit = 's',
    #     visibility = (),
    #     pollinterval = None,
    # ),
    timer = device('nicos.devices.mcstas.McStasTimer',
        description='McStas timer channel',
        mcstas = 'mcstas',
        fmtstr = '%.2f',
        unit = 's',
        visibility = (),
        pollinterval = None,
    ),
    image_virtual = device('nicos_mlz.toftof.devices.virtual.VirtualImage',
        description = 'Image data device',
        fmtstr = '%d',
        pollinterval = None,
        visibility = (),
        numinputs = 1006,
        size = (1024, 1024),
        datafile = 'nicos_virt_mlz/toftof/data/test/data.npz',
    ),
    mcstas = device('nicos_virt_mlz.toftof.devices.detector.McStasSimulation',
        description = 'McStas simulation',
        mcstasprog = 'toftof',
        intensityfactor = 10,  # e14,
        sample = 'Sample',
        wavelength = 'chWL',
        speed = 'chSpeed',
        ratio = 'chRatio',
        st = 'chST',
        slit = 'slit',
        neutronspersec = {
            'localhost': 1.12e5,
        },
        repeat_curve = (
            (1, 2.1),
            (2, 3.3),
            (5, 6.8),
            (10, 13.0),
            (20, 25.0),
            (50, 61.5),
            (100, 121.7),
            (200, 242.4),
            (500, 603.6),
            (1000, 1206.6),
            (2000, 2405.4),
            (5000, 6031.0),
            (10000, 12143.8),
            (20000, 24308.8),
            (50000, 61000.0),
            (100000, 123000.0),
        ),
    ),
    image = device('nicos_virt_mlz.toftof.devices.detector.Image',
        description = 'Image data device',
        mcstas = 'mcstas',
        mcstasfile = 'detector_output.dat',
        size = (1024, 1024),
        fmtstr = '%d',
        unit = 'cts',
        pollinterval = 86400,
        visibility = (),
    ),
    det = device('nicos_virt_mlz.toftof.devices.Detector',
        description = 'The TOFTOF detector device',
        mcstas = 'mcstas',
        timers = ['timer'],
        monitors = ['monitor'],
        images = ['image'],
        rc = 'rc_onoff',
        chopper = 'ch',
        chdelay = 'chdelay',
        maxage = 12,
        pollinterval = None,
        liveinterval = 10.0,
        saveintervals = [30.],
        detinfofile = '/control/nicos_mlz/toftof/detinfo.dat',
    ),
)
