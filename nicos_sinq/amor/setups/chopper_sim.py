description = 'Airbus chopper device in SINQ AMOR, Simulation'

display_order = 33

excludes = ['chopper']

devices = dict(
    chopper_phase = device('nicos.devices.generic.manual.ManualMove',
                           description = 'phase between closing of 1st and opening of 2nd chopper',
                           unit = 'deg',
                           abslimits = (-30, 30),
                           default = 0,
                           fmtstr = '%6.2f',
                           visibility = ('metadata', 'namespace'),
                           ),
    ch1_speed = device('nicos.devices.generic.manual.ManualMove',
                       description = 'speed of the (pulse generating) 1st chopper',
                       unit = 'rpm',
                       abslimits = (0, 2000),
                       default = 500,
                       fmtstr = '%4.0f',
                       visibility = ('metadata', 'namespace'),
                       ),
    ch1_position = device('nicos.devices.generic.manual.ManualMove',
                          description = 'phase of the (pulse generating) 1st chopper',
                          unit = 'degree',
                          abslimits = (0, 360),
                          default = 0,
                          visibility = ('metadata', 'namespace'),
                          ),
    ch1_trigger_phase = device('nicos.devices.generic.manual.ManualMove',
                               description = '1st chopper: phase between closing edge and trigger pulse',
                               unit = 'degree',
                               abslimits = (-14, 14),
                               default = -9.10,
                               visibility = ('metadata', 'namespace'),
                               ),
    ch2_speed = device('nicos.devices.generic.manual.ManualMove',
                       description = 'speed of the 2nd chopper',
                       unit = 'rpm',
                       abslimits = (0, 2000),
                       default = 500,
                       fmtstr = '%4.0f',
                       visibility = ('metadata', 'namespace'),
                       ),
    ch2_phase = device('nicos.devices.generic.manual.ManualMove',
                       description = 'phase of the 2nd chopper (w.r.t. 1st chopper)',
                       unit = 'degree',
                       abslimits = (0, 360),
                       default = 13.5,
                       fmtstr = '%6.2f',
                       visibility = ('metadata', 'namespace'),
                       ),
    ch2_trigger_phase = device('nicos.devices.generic.manual.ManualMove',
                               description = '2nd chopper: phase between closing edge and trigger pulse',
                               unit = 'degree',
                               abslimits = (-14, 14),
                               default = 6.75,
                               visibility = ('metadata', 'namespace'),
                               ),
    ch2_trigger = device('nicos_sinq.devices.counters.KafkaCounter',
                         description = 'trigger time of 1st chopper and delay of 2nd chopper',
                         brokers = configdata('config.KAFKA_BROKERS'),
                         # TODO: change topic name to 'ch2_trigger'
                         topic = 'amor_beam_monitor',
                         source = 'ttlmon0',
                         type = 'monitor',
                         visibility = ('metadata', 'namespace'),
                         ),
    ch2_gear_ratio = device('nicos.devices.generic.manual.ManualMove',
                            description = '2nd chopper gear ratio',
                            unit = '',
                            abslimits = (0, 4),
                            default = 1,
                            visibility = ('metadata', 'namespace'),
                            ),
    )
