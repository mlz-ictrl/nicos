description = 'Selene support devices in AMOR'

display_order = 82

devices = dict(
    selene = device('nicos_sinq.amor.devices.selene.Selene',
                    description = 'Selene support devices in AMOR',
                    position = [-1.1 for _ in range(36)],
                    low_limit_narrow = [-2.0 for _ in range(36)],
                    high_limit_narrow = [2.0 for _ in range(36)],
                    low_limit_wide = [-10.0 for _ in range(36)],
                    high_limit_wide = [10.0 for _ in range(36)],
                    working_position = [0.0 for _ in range(36)],
                    backup_path = '/home/amor/nicos/backup',
                    motor = ['smp1', 'smp2'],
                    range_selector = ['mcu1', 'mcu2'],
                    digital_input = [f'p{(p + 1):02d}' for p in range(36)],
                    asyn = 'selene_asyn_channel',
                    requires = {'level': 'admin'},
                    ),
    selene_asyn_channel = device('nicos_sinq.devices.epics.extensions.EpicsCommandReply',
                                 description = 'Direct communication to the mcu',
                                 commandpv = 'SQ:AMOR:SEL2.AOUT',
                                 replypv = 'SQ:AMOR:SEL2.AINP',
                                 requires = {'level': 'admin'},
                                 ),
    smp1 = device('nicos_sinq.amor.devices.selene.SeleneEpicsMotor',
                  description = 'Pitch motor for selene1',
                  readpv = 'SQ:AMOR:turboPmac2:s1_pitch.RBV',
                  writepv = 'SQ:AMOR:turboPmac2:s1_pitch.VAL',
                  motorpv = 'SQ:AMOR:turboPmac2:s1_pitch',
                  errormsgpv = 'SQ:AMOR:turboPmac2:s1_pitch-MsgTxt',
                  abslimits = (-10.0, 10.0),
                  requires = {'level': 'admin'},
                  ),
    mcu1 = device('nicos_sinq.amor.devices.selene.RangeSelector',
                  description = 'Motor control unit for selene2',
                  id = 1,
                  readpv = 'SQ:AMOR:SEL2:MCU1:FineAdjustment:Selected',
                  writepv = 'SQ:AMOR:SEL2:MCU1:FineAdjustment:Select',
                  pvprefix = 'SQ:AMOR:SEL2',
                  requires = {'level': 'admin'},
                  ),
    smp2 = device('nicos_sinq.amor.devices.selene.SeleneEpicsMotor',
                  description = 'Pitch motor for selene2',
                  readpv = 'SQ:AMOR:turboPmac2:s2_pitch.RBV',
                  writepv = 'SQ:AMOR:turboPmac2:s2_pitch.VAL',
                  motorpv = 'SQ:AMOR:turboPmac2:s2_pitch',
                  errormsgpv = 'SQ:AMOR:turboPmac2:s2_pitch-MsgTxt',
                  abslimits = (-10.0, 10.0),
                  requires = {'level': 'admin'},
                  ),
    mcu2 = device('nicos_sinq.amor.devices.selene.RangeSelector',
                  description = 'Motor control unit for selene2',
                  id = 2,
                  readpv = 'SQ:AMOR:SEL2:MCU2:FineAdjustment:Selected',
                  writepv = 'SQ:AMOR:SEL2:MCU2:FineAdjustment:Select',
                  pvprefix = 'SQ:AMOR:SEL2',
                  requires = {'level': 'admin'},
                  ),
    sel2 = device('nicos_sinq.devices.epics.extensions.EpicsCommandReply',
                  description = 'Controller of the devices connected to the selene MCU',
                  commandpv = 'SQ:AMOR:SEL2' + '.AOUT',
                  replypv = 'SQ:AMOR:SEL2' + '.AINP',
                  requires = {'level': 'admin'},
                  ),
    )

for p in range(1, 37):
    devices[f'p{p:02d}'] = device('nicos_sinq.amor.devices.selene.DigitalInput',
                                  description = 'Digital input for the pitch %d' % p,
                                  pitch = p,
                                  pvprefix = 'SQ:AMOR:SEL2',
                                  readpv = f'SQ:AMOR:SEL2:P{p}:Selected',
                                  fmtstr = '%d',
                                  pollinterval = 5,
                                  requires = {'level': 'admin'},
                                  )
