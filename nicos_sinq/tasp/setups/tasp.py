description = 'Standard setup for TASP'

motaprefix = 'SQ:TASP:mota:'
motbprefix = 'SQ:TASP:motb:'
countprefix = 'SQ:TASP:counter'

devices = dict(
    a1 = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Monochromator omega',
        motorpv = motaprefix + 'A1',
        errormsgpv = motaprefix + 'A1-MsgTxt',
        precision = 0.02,
    ),
    mcv = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Monochromator curvature',
        motorpv = motaprefix + 'MCV',
        errormsgpv = motaprefix + 'MCV-MsgTxt',
        precision = 0.02,
    ),
    mtl = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Monochromator lower translation',
        motorpv = motaprefix + 'MTL',
        errormsgpv = motaprefix + 'MTL-MsgTxt',
        precision = 0.02,
    ),
    mtu = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Monochromator upper translation',
        motorpv = motaprefix + 'MTU',
        errormsgpv = motaprefix + 'MTU-MsgTxt',
        precision = 0.02,
    ),
    mgl = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Monochromator goniometer',
        motorpv = motaprefix + 'MGL',
        errormsgpv = motaprefix + 'MGL-MsgTxt',
        precision = 0.02,
    ),
    a2 = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Monochromator tow that',
        motorpv = motaprefix + 'A2',
        errormsgpv = motaprefix + 'A2-MsgTxt',
        precision = 0.02,
    ),
    a3_st = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Sample rotation',
        motorpv = motaprefix + 'A3',
        errormsgpv = motaprefix + 'A3-MsgTxt',
        precision = 0.02,
    ),
    a3 = device('nicos.core.device.DeviceAlias',
        description = 'Alias for a3',
        alias = 'a3_st',
        devclass = 'nicos.core.device.Moveable'
    ),
    a4 = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Sample two theta',
        motorpv = motaprefix + 'A4',
        errormsgpv = motaprefix + 'A4-MsgTxt',
        precision = 0.02,
    ),
    sro = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Sample auxiliary rotation',
        motorpv = motaprefix + 'SRO',
        errormsgpv = motaprefix + 'SRO-MsgTxt',
        precision = 0.02,
    ),
    stl = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Sample lower translation',
        motorpv = motbprefix + 'STL',
        errormsgpv = motbprefix + 'STL-MsgTxt',
        precision = 0.02,
    ),
    stu = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Sample upper translation',
        motorpv = motbprefix + 'STU',
        errormsgpv = motbprefix + 'STU-MsgTxt',
        precision = 0.02,
    ),
    sgl = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Sample lower tilt',
        motorpv = motbprefix + 'SGL',
        errormsgpv = motbprefix + 'SGL-MsgTxt',
        precision = 0.02,
    ),
    sgu = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Sample upper tilt',
        motorpv = motbprefix + 'SGU',
        errormsgpv = motbprefix + 'SGU-MsgTxt',
        precision = 0.02,
    ),
    a5 = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Analyser rotation',
        motorpv = motbprefix + 'A5',
        errormsgpv = motbprefix + 'A5-MsgTxt',
        precision = 0.02,
    ),
    ach = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Analyser curvature',
        motorpv = motbprefix + 'ACH',
        errormsgpv = motbprefix + 'ACH-MsgTxt',
        precision = 0.04,
    ),
    atl = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Analyser lower translation',
        motorpv = motbprefix + 'ATL',
        errormsgpv = motbprefix + 'ATL-MsgTxt',
        precision = 0.02,
    ),
    atu = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Analyser upper translation',
        motorpv = motbprefix + 'ATU',
        errormsgpv = motbprefix + 'ATU-MsgTxt',
        precision = 0.02,
    ),
    a6_raw = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Analyser two theta',
        motorpv = motbprefix + 'A6',
        errormsgpv = motbprefix + 'A6-MsgTxt',
        precision = 0.02,
    ),
    a6 = device('nicos_sinq.eiger.devices.a6motor.A6Motor',
        description = 'Analyser two theta',
        raw_motor = 'a6_raw',
        wait_period = 7,
        precision = .02,
    ),
    agl = device('nicos_sinq.devices.epics.motor_deprecated.EpicsMotor',
        description = 'Analyser goniometer',
        motorpv = motbprefix + 'AGL',
        errormsgpv = motbprefix + 'AGL-MsgTxt',
        precision = 0.02,
    ),
    elapsedtime = device(
        'nicos_sinq.devices.epics.sinqdaq.DAQTime',
        daqpvprefix = countprefix,
    ),
    DAQPreset = device(
        'nicos_sinq.devices.epics.sinqdaq.DAQPreset',
        description = '8 Channel EL737 Counterbox',
        daqpvprefix = countprefix,
        channels = ['protoncount', 'monitor2'],
        time_channel = ['elapsedtime'],
    ),
    ThresholdChannel = device(
        'nicos_sinq.devices.epics.sinqdaq.DAQMinThresholdChannel',
        daqpvprefix = countprefix,
        channels = ['protoncount', 'monitor2'],
    ),
    Threshold = device(
        'nicos_sinq.devices.epics.sinqdaq.DAQMinThreshold',
        daqpvprefix = countprefix,
        min_rate_channel = 'ThresholdChannel',
    ),
    protoncount = device(
        'nicos_sinq.devices.epics.sinqdaq.DAQChannel',
        description = 'Monitor for proton current',
        daqpvprefix = countprefix,
        channel = 5,
        type = 'monitor',
    ),
    # At TASP, the neutron monitors are enumerated as follows:
    # 1: Monitor in guide (device monitor1)
    # 2: Monitor directly before sample (device monitor2)
    # 3: Monitor in monochromator (device monitor3)
    # 4: Detector (device detector)
    # However, only channel 1 of the counterbox can deal with monitor presets.
    # Hence, the counterbox driver channels have to be adjusted accordingly in
    # the devices, see the setups below).
    monitor1 = device(
        'nicos_sinq.devices.epics.sinqdaq.DAQChannel',
        description = 'Monitor in guide',
        daqpvprefix = countprefix,
        channel = 3,
        type = 'counter',
    ),
    monitor2 = device(
        'nicos_sinq.devices.epics.sinqdaq.DAQChannel',
        description = 'Preset monitor',
        daqpvprefix = countprefix,
        channel = 1,
        type = 'monitor',
    ),
    monitor3 = device(
        'nicos_sinq.devices.epics.sinqdaq.DAQChannel',
        description = 'Monitor before analyzer',
        daqpvprefix = countprefix,
        channel = 4,
        type = 'counter',
    ),
    detector = device(
        'nicos_sinq.devices.epics.sinqdaq.DAQChannel',
        description = 'Actual neutron detector',
        daqpvprefix = countprefix,
        channel = 2,
        type = 'counter',
    ),
    taspdet = device(
        'nicos_sinq.devices.epics.sinqdaq.SinqDetector',
        description = 'Detector Interface',
        timers = ['elapsedtime'],
        monitors = ['DAQPreset', 'detector', 'monitor1', 'monitor2', 'monitor3'],
        others = [],
        liveinterval = 1,
    ),
    mono = device('nicos_sinq.devices.mono.SinqMonochromator',
        description = 'TASP monochromator',
        theta = 'a1',
        twotheta = 'a2',
        material = 'PG',
        reflection = (0, 0, 2),
        dvalue = 3.354,
        scatteringsense = -1,
        crystalside = -1,
        unit = 'meV',
        focmode = 'vertical',
        vfocuspars = [2.9, 8.45714],
        abslimits = [2.75, 20],
        focusv = 'mcv'
    ),
    ana = device('nicos_sinq.devices.mono.TasAnalyser',
        description = 'TASP analyser',
        theta = 'a5',
        twotheta = 'a6',
        material = 'PG',
        reflection = (0, 0, 2),
        dvalue = 3.354,
        scatteringsense = -1,
        crystalside = -1,
        unit = 'meV',
        focmode = 'horizontal',
        hfocuspars = [0.25, 4.01],
        abslimits = [2.75, 20],
        focush = 'ach'
    ),
    ei = device('nicos.core.device.DeviceAlias',
        description = 'Alias for driving the monochromator',
        alias = 'mono',
    ),
    ef = device('nicos.core.device.DeviceAlias',
        description = 'Alias for driving the analyser',
        alias = 'ana',
    ),
)

startupcode = """
SetDetectors(taspdet)
DAQPreset.monitor_channel = 'monitor2'
move(ThresholdChannel, 'monitor2')
move(Threshold, 200)
"""
